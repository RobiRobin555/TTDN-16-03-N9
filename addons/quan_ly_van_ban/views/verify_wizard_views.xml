<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <record id="view_qlvb_verify_wizard_form" model="ir.ui.view">
            <field name="name">qlvb.verify.wizard.form</field>
            <field name="model">qlvb.verify.wizard</field>
            <field name="arch" type="xml">
                <form string="C√¥ng c·ª• X√°c th·ª±c VƒÉn b·∫£n">
                    <sheet>
                        <field name="check_performed" invisible="1"/>
                        <field name="has_data" invisible="1"/>
                        <field name="show_result" invisible="1"/>

                        <div class="text-center mb-3" style="background-color: #f8f9fa; padding: 15px; border-radius: 5px;">
                            <h2 style="color: #2c3e50; margin: 0;">
                                <i class="fa fa-shield text-primary"/> C·ªïng X√°c Th·ª±c Ch·ªØ K√Ω S·ªë
                            </h2>
                            <div attrs="{'invisible': [('check_performed', '=', True)]}">
                                <small class="text-muted">
                                    <i class="fa fa-info-circle"/> H·ªá th·ªëng ƒë√£ t√¨m th·∫•y Public Key v√† Ng∆∞·ªùi k√Ω. 
                                    Vui l√≤ng b·∫•m <b>"Ki·ªÉm tra"</b> ƒë·ªÉ x√°c th·ª±c t√≠nh to√†n v·∫πn.
                                </small>
                            </div>
                            <div attrs="{'invisible': [('check_performed', '=', False)]}">
                                <small class="text-success font-weight-bold">
                                    <i class="fa fa-check"/> ƒê√£ ho√†n t·∫•t ki·ªÉm tra k·ªπ thu·∫≠t.
                                </small>
                            </div>
                        </div>

                        <group>
                            <group>
                                <field name="file" filename="file_name" widget="binary" height="50" string="Ch·ªçn File PDF" required="1"/>
                                <field name="file_name" invisible="1"/>
                            </group>
                            <group>
                                 <button name="action_verify" string="üîí B·∫ÆT ƒê·∫¶U KI·ªÇM TRA" type="object" 
                                        class="btn-primary" icon="fa-lock"
                                        attrs="{'invisible': ['|', ('file', '=', False), ('check_performed', '=', True)]}"/>
                                 
                                 <button name="action_verify" string="Ki·ªÉm tra l·∫°i" type="object" 
                                        class="btn-secondary" icon="fa-refresh"
                                        attrs="{'invisible': [('check_performed', '=', False)]}"/>
                            </group>
                        </group>

                        <div attrs="{'invisible': [('has_data', '=', False)]}">
                            
                            <div class="row mt-2 mb-2" attrs="{'invisible': [('check_performed', '=', False)]}">
                                <div class="col-12 text-center">
                                    <field name="verification_status" widget="badge"
                                           decoration-success="verification_status == 'VALID'"
                                           decoration-danger="verification_status in ('TAMPERED', 'INVALID', 'ERROR')"
                                           decoration-warning="verification_status == 'UNSIGNED'"
                                           style="font-size: 18px; padding: 10px 30px; border-radius: 20px;"/>
                                </div>
                            </div>

                            <notebook>
                                <page string="Danh s√°ch Ng∆∞·ªùi k√Ω">
                                    <field name="signature_ids" readonly="1" force_save="1">
                                        <tree decoration-danger="is_intact == False and wizard_checked == True" 
                                              decoration-success="is_intact == True and wizard_checked == True">
                                            
                                            <field name="wizard_checked" invisible="1"/>

                                            <field name="owner_avatar" widget="image" height="30" string="Avatar"/>
                                            <field name="owner_info" decoration-bf="1" string="User HT"/>
                                            <field name="signer_name" string="T√™n trong PDF"/>
                                            <field name="organization" optional="hide"/>

                                            <button name="get_formview_action" string="Xem Public Key" type="object" icon="fa-key"/>

                                            <field name="is_intact" widget="boolean_toggle" 
                                                   attrs="{'column_invisible': [('parent.check_performed', '=', False)]}"/>
                                            <field name="is_valid" widget="boolean_toggle" 
                                                   attrs="{'column_invisible': [('parent.check_performed', '=', False)]}"/>
                                            <field name="signing_time" 
                                                   attrs="{'column_invisible': [('parent.check_performed', '=', False)]}"/>
                                        </tree>
                                        
                                        <form>
                                            <sheet>
                                                <div class="oe_title">
                                                    <field name="owner_avatar" widget="image" class="oe_avatar"/>
                                                    <h1><field name="signer_name"/></h1>
                                                    <h3><field name="organization"/></h3>
                                                </div>
                                                <notebook>
                                                    <page string="üîë Public Key">
                                                        <div class="alert alert-info">
                                                            M√£ kh√≥a c√¥ng khai tr√≠ch xu·∫•t t·ª´ file PDF:
                                                        </div>
                                                        <field name="public_key_pem" widget="text"
                                                               style="font-family: monospace; font-size: 11px; white-space: pre-wrap; word-break: break-all; background: #f0f0f0; padding: 15px; border: 1px solid #ccc;" 
                                                               readonly="1"/>
                                                    </page>
                                                    
                                                    <page string="üõ°Ô∏è K·∫øt qu·∫£ K·ªπ thu·∫≠t" attrs="{'invisible': [('parent.check_performed', '=', False)]}">
                                                        <group>
                                                            <group string="Tr·∫°ng th√°i">
                                                                <field name="is_intact" widget="boolean_toggle"/>
                                                                <field name="is_valid" widget="boolean_toggle"/>
                                                            </group>
                                                            <group string="Ch·ª©ng th∆∞">
                                                                <field name="serial_number"/>
                                                                <field name="issuer"/>
                                                                <field name="signing_time"/>
                                                            </group>
                                                        </group>
                                                        <field name="validation_summary"/>
                                                    </page>
                                                </notebook>
                                            </sheet>
                                        </form>
                                    </field>
                                </page>
                            </notebook>
                        </div>
                    </sheet>
                    <footer>
                        <button string="ƒê√≥ng" class="btn-secondary" special="cancel"/>
                    </footer>
                </form>
            </field>
        </record>
        <record id="action_qlvb_verify_tool" model="ir.actions.act_window">
            <field name="name">X√°c th·ª±c VƒÉn b·∫£n</field>
            <field name="res_model">qlvb.verify.wizard</field>
            <field name="view_mode">form</field>
            <field name="target">new</field>
            <field name="context">{'default_show_result': False}</field>
        </record>

        <menuitem id="menu_qlvb_verify_tool" 
                  name="X√°c th·ª±c (Verify)" 
                  parent="menu_qlvb_root" 
                  action="action_qlvb_verify_tool" 
                  sequence="99"/>
    </data>
</odoo>
